let V="ltr";isRtl&&(V="rtl");document.addEventListener("DOMContentLoaded",function(){(function(){const H=document.getElementById("calendar"),P=document.querySelector(".app-calendar-sidebar"),q=document.getElementById("addEventSidebar"),A=document.querySelector(".app-overlay"),G={Business:"primary",Holiday:"success",Personal:"danger",Family:"warning",ETC:"info"},c=document.querySelector("#eventForm .offcanvas-title"),D=document.querySelector(".btn-toggle-sidebar"),r=document.querySelector('#eventForm button[type="submit"]'),h=document.querySelector(".btn-delete-event"),O=document.querySelector(".btn-cancel"),S=document.querySelector("#eventTitle"),s=document.querySelector("#eventStartDate"),o=document.querySelector("#eventEndDate"),E=document.querySelector("#eventURL"),u=$("#eventLabel"),d=$("#eventGuests"),L=document.querySelector("#eventLocation"),T=document.querySelector("#eventDescription"),p=document.querySelector(".allDay-switch"),k=document.querySelector(".select-all"),C=[].slice.call(document.querySelectorAll(".input-filter")),M=document.querySelector(".inline-calendar");let a,v=events,x=!1,F;const g=new bootstrap.Offcanvas(q);//! TODO: Update Event label and guest code to JS once select removes jQuery dependency
if(u.length){let e=function(t){if(!t.id)return t.text;var l="<span class='badge badge-dot bg-"+$(t.element).data("label")+" me-2'> </span>"+t.text;return l};var W=e;u.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:u.parent(),templateResult:e,templateSelection:e,minimumResultsForSearch:-1,escapeMarkup:function(t){return t}})}if(d.length){let e=function(t){if(!t.id)return t.text;var l="<div class='d-flex flex-wrap align-items-center'><div class='avatar avatar-xs me-2'><img src='"+assetsPath+"img/avatars/"+$(t.element).data("avatar")+"' alt='avatar' class='rounded-circle' /></div>"+t.text+"</div>";return l};var K=e;d.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:d.parent(),closeOnSelect:!1,templateResult:e,templateSelection:e,escapeMarkup:function(t){return t}})}if(s)var R=s.flatpickr({enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,l){l.isMobile&&l.mobileInput.setAttribute("step",null)}});if(o)var I=o.flatpickr({enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,l){l.isMobile&&l.mobileInput.setAttribute("step",null)}});M&&(F=M.flatpickr({monthSelectorType:"static",inline:!0}));function U(e){a=e.event,a.url&&e.jsEvent.preventDefault(),g.show(),c&&(c.innerHTML="Update Event"),r.innerHTML="Update",r.classList.add("btn-update-event"),r.classList.remove("btn-add-event"),h.classList.remove("d-none"),S.value=a.title,R.setDate(a.start,!0,"Y-m-d"),a.allDay===!0?p.checked=!0:p.checked=!1,a.end!==null?I.setDate(a.end,!0,"Y-m-d"):I.setDate(a.start,!0,"Y-m-d"),u.val(a.extendedProps.calendar).trigger("change"),a.extendedProps.location!==void 0&&(L.value=a.extendedProps.location),a.extendedProps.guests!==void 0&&d.val(a.extendedProps.guests).trigger("change"),a.extendedProps.description!==void 0&&(T.value=a.extendedProps.description)}function w(){const e=document.querySelector(".fc-sidebarToggle-button");for(e.classList.remove("fc-button-primary"),e.classList.add("d-lg-none","d-inline-block","ps-0");e.firstChild;)e.firstChild.remove();e.setAttribute("data-bs-toggle","sidebar"),e.setAttribute("data-overlay",""),e.setAttribute("data-target","#app-calendar-sidebar"),e.insertAdjacentHTML("beforeend",'<i class="bx bx-menu bx-sm text-heading"></i>')}function Y(){let e=[];return[].slice.call(document.querySelectorAll(".input-filter:checked")).forEach(l=>{e.push(l.getAttribute("data-value"))}),e}function j(e,t){$.ajax({url:"/admin/get-events",type:"GET",success:function(n){Y()},error:function(n){console.log(n)}});let l=Y(),m=v.filter(function(n){return l.includes(n.extendedProps.calendar.toLowerCase())});t(m)}let i=new Calendar(H,{initialView:"dayGridMonth",events:j,plugins:[dayGridPlugin,interactionPlugin,listPlugin,timegridPlugin],editable:!0,dragScroll:!0,dayMaxEvents:2,eventResizableFromStart:!0,customButtons:{sidebarToggle:{text:"Sidebar"}},headerToolbar:{start:"sidebarToggle, prev,next, title",end:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},direction:V,initialDate:new Date,navLinks:!0,eventClassNames:function({event:e}){return["fc-event-"+G[e._def.extendedProps.calendar]]},dateClick:function(e){let t=moment(e.date).format("YYYY-MM-DD");B(),g.show(),c&&(c.innerHTML="Add Event"),r.innerHTML="Add",r.classList.remove("btn-update-event"),r.classList.add("btn-add-event"),h.classList.add("d-none"),s.value=t,o.value=t},eventClick:function(e){U(e)},datesSet:function(){w()},viewDidMount:function(){w()}});i.render(),w();const b=document.getElementById("eventForm");FormValidation.formValidation(b,{fields:{eventTitle:{validators:{notEmpty:{message:"Please enter event title "}}},eventStartDate:{validators:{notEmpty:{message:"Please enter start date "}}},eventEndDate:{validators:{notEmpty:{message:"Please enter end date "}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(e,t){return".mb-3"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){x=!0}).on("core.form.invalid",function(){x=!1}),D&&D.addEventListener("click",e=>{O.classList.remove("d-none")});function N(e){$.ajax({url:b.action,type:"POST",data:new FormData(b),processData:!1,contentType:!1,success:function(t){console.log(t),t.status==!0?f("Appointment created successfully"):f(t.error)},error:function(t){console.error("Error:",t),f(t.responseJSON.message)}}),v.push(e),i.refetchEvents()}function f(e){const t=document.getElementById("toast");t.querySelector(".toast-body").textContent=e,new bootstrap.Toast(t).show()}function J(e){e.id=parseInt(e.id);let t=new FormData(b);t.append("id",e.id),$.ajax({url:b.action,type:"POST",data:t,processData:!1,contentType:!1,success:function(n){console.log(n),n.status==!0?f("Appointment updated successfully"):f(n.error)},error:function(n){console.error("Error:",n),f(n.responseJSON.message)}}),v[v.findIndex(n=>n.id===e.id)]=e,i.refetchEvents(),z(e,["id","title","url"],["calendar","guests","location","description"])}function _(e){v=v.filter(function(t){return t.id!=e}),i.refetchEvents()}const z=(e,t,l)=>{const m=i.getEventById(e.id);for(var n=0;n<t.length;n++){var y=t[n];m.setProp(y,e[y])}m.setDates(e.start,e.end,{allDay:e.allDay});for(var n=0;n<l.length;n++){var y=l[n];m.setExtendedProp(y,e.extendedProps[y])}};r.addEventListener("click",e=>{if(r.classList.contains("btn-add-event")){if(x){let t={id:i.getEvents().length+1,title:S.value,start:s.value,end:o.value,startStr:s.value,endStr:o.value,display:"block",extendedProps:{location:L.value,guests:d.val(),calendar:u.val(),description:T.value}};E.value&&(t.url=E.value),p.checked&&(t.allDay=!0),console.log(t),N(t),g.hide()}}else if(x){let t={id:a.id,title:S.value,start:s.value,end:o.value,url:E.value,extendedProps:{location:L.value,guests:d.val(),calendar:u.val(),description:T.value},display:"block",allDay:!!p.checked};J(t),g.hide()}}),h.addEventListener("click",e=>{_(parseInt(a.id)),$.ajax({url:"/admin/events/"+a.id,type:"DELETE",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(t){console.log(t.message)},error:function(t){console.error(t.responseText)}}),g.hide()});function B(){o.value="",E.value="",s.value="",S.value="",L.value="",p.checked=!1,d.val("").trigger("change"),T.value=""}q.addEventListener("hidden.bs.offcanvas",function(){B()}),D.addEventListener("click",e=>{c&&(c.innerHTML="Add Event"),r.innerHTML="Add",r.classList.remove("btn-update-event"),r.classList.add("btn-add-event"),h.classList.add("d-none"),P.classList.remove("show"),A.classList.remove("show")}),k&&k.addEventListener("click",e=>{e.currentTarget.checked?document.querySelectorAll(".input-filter").forEach(t=>t.checked=1):document.querySelectorAll(".input-filter").forEach(t=>t.checked=0),i.refetchEvents()}),C&&C.forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".input-filter:checked").length<document.querySelectorAll(".input-filter").length?k.checked=!1:k.checked=!0,i.refetchEvents()})}),F.config.onChange.push(function(e){i.changeView(i.view.type,moment(e[0]).format("YYYY-MM-DD")),w(),P.classList.remove("show"),A.classList.remove("show")})})()});
